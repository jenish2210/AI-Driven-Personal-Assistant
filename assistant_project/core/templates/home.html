<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Personal Assistant</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
        }
        .container {
            width: 80%;
            max-width: 600px;
            margin: 50px auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
        }
        h1 {
            color: #333;
        }
        .button-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }
        .btn {
            padding: 12px;
            width: 100%;
            border: none;
            border-radius: 5px;
            background-color: #007bff;
            color: white;
            font-size: 16px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
        }
        .btn:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>AI Personal Assistant</h1>
        <p>Welcome to your AI-powered assistant! Choose a feature below:</p>
        
        <div class="button-container">
            <a href="{% url 'chatbot' %}" class="btn">üó£Ô∏è Chatbot</a>
            <a href="{% url 'emergency_alert' %}" class="btn">üö® Emergency Alert</a>
            <a href="{% url 'task_manager' %}" class="btn">üìÖ Task Manager</a>
            <a href="{% url 'text_to_speech_view' %}" class="btn">üéôÔ∏è Text-to-Speech</a>
            <a href="{% url 'speech_to_text_view' %}" class="btn">üé§ Speech-to-Text</a>

        </div>
        <div class="reminder-section">
            <h2>üìÖ Add Reminder</h2>
            <form id="reminder-form">
                {% csrf_token %}
                <input type="text" id="reminder-text" name="reminder_text" placeholder="Enter reminder..." required>
                <input type="datetime-local" id="reminder-time" name="reminder_time" required>
                <button type="submit">Add Reminder</button>
            </form>
        
            <h3>‚è∞ Upcoming Reminders:</h3>
            <ul id="reminder-list">
                {% for reminder in reminders %}
                    <li>{{ reminder.text }} - {{ reminder.time }}</li>
                {% empty %}
                    <li>No reminders yet.</li>
                {% endfor %}
            </ul>
            <ul id="reminder-list">
                {% for reminder in reminders %}
                    <li>
                        {{ reminder.text }} - {{ reminder.time }}
                        <button class="delete-btn" data-id="{{ reminder.id }}">‚ùå</button>
                    </li>
                {% empty %}
                    <li>No reminders yet.</li>
                {% endfor %}
            </ul>
            <button id="voice-reminder-btn">üéôÔ∏è Speak Reminder</button>

            
        </div>
        <script>
            document.addEventListener("click", function(event) {
                if (event.target.classList.contains("delete-btn")) {
                    let reminderId = event.target.dataset.id;
            
                    fetch(`/delete-reminder/${reminderId}/`, {
                        method: "DELETE",
                        headers: {
                            "X-CSRFToken": document.querySelector("[name=csrfmiddlewaretoken]").value
                        }
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.message) {
                            event.target.parentElement.remove(); // Remove from UI
                        }
                    });
                }
            });
            </script>
            
        
        <script>
        document.getElementById("reminder-form").addEventListener("submit", function(event) {
            event.preventDefault();
        
            let formData = new FormData(this);
        
            fetch("{% url 'add_reminder' %}", {
                method: "POST",
                body: formData,
                headers: {
                    "X-CSRFToken": document.querySelector("[name=csrfmiddlewaretoken]").value
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.reminder) {
                    let reminderList = document.getElementById("reminder-list");
                    let newReminder = document.createElement("li");
                    newReminder.textContent = `${data.reminder.text} - ${data.reminder.time}`;
                    reminderList.appendChild(newReminder);
                }
            });
        
            this.reset(); // Clear input fields after submission
        });
        </script>
        <script>
            function checkReminders() {
                let reminders = JSON.parse(localStorage.getItem("reminders")) || [];
                let currentTime = new Date().toISOString().slice(0, 16); // Current time in "YYYY-MM-DDTHH:MM" format
            
                reminders.forEach((reminder, index) => {
                    if (reminder.time === currentTime) {
                        alert(`‚è∞ Reminder: ${reminder.text}`);
                        reminders.splice(index, 1); // Remove reminder after showing alert
                    }
                });
            
                localStorage.setItem("reminders", JSON.stringify(reminders));
            }
            
            setInterval(checkReminders, 60000); // Check reminders every 60 seconds
            
            document.getElementById("reminder-form").addEventListener("submit", function(event) {
                event.preventDefault();
            
                let text = document.getElementById("reminder-text").value;
                let time = document.getElementById("reminder-time").value;
                
                if (text && time) {
                    let reminders = JSON.parse(localStorage.getItem("reminders")) || [];
                    reminders.push({ text, time });
                    localStorage.setItem("reminders", JSON.stringify(reminders));
                }
            });
            </script>
            <script>
                document.getElementById("voice-reminder-btn").addEventListener("click", function() {
                    let recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
                    recognition.lang = "en-US";
                
                    recognition.onstart = function() {
                        console.log("Listening for a reminder...");
                    };
                
                    recognition.onresult = function(event) {
                        let speechText = event.results[0][0].transcript;
                        console.log("Recognized text:", speechText);
                
                        // Extract time and text from the voice command
                        let reminderTime = extractTime(speechText);
                        let reminderText = speechText.replace(reminderTime, "").trim();
                
                        if (reminderTime && reminderText) {
                            document.getElementById("reminder-text").value = reminderText;
                            document.getElementById("reminder-time").value = reminderTime;
                            document.getElementById("reminder-form").submit(); // Auto-submit the form
                        } else {
                            alert("Couldn't understand the time. Please try again.");
                        }
                    };
                
                    recognition.start();
                });
                
                // Function to extract time from the spoken text
                function extractTime(speechText) {
                    let timeRegex = /\b(\d{1,2}(:\d{2})?\s?(AM|PM)?)\b/i;
                    let match = speechText.match(timeRegex);
                    
                    if (match) {
                        let timeStr = match[1].toUpperCase();
                        
                        // Convert to 24-hour format if necessary
                        let date = new Date();
                        let [hour, minute] = timeStr.includes(":") ? timeStr.split(":") : [timeStr, "00"];
                        
                        hour = parseInt(hour);
                        minute = parseInt(minute);
                
                        if (timeStr.includes("PM") && hour < 12) hour += 12;
                        if (timeStr.includes("AM") && hour === 12) hour = 0;
                
                        date.setHours(hour, minute);
                        return date.toISOString().slice(0, 16); // Convert to "YYYY-MM-DDTHH:MM" format
                    }
                    return null;
                }
                </script>
                
            
        
        
    </div>

</body>
</html>
